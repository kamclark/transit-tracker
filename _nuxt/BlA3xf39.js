import{d as $,x as l,y as i,z as a,A as u,J as T,K as A,L as M,M as K,D as w,N as y,r as m,O as L,P as Q,Q as W,R as q,k as D,o as X,S as Y,B as N}from"./DJIT7Z0_.js";const Z={key:0,class:"nearest-highlight station-info mb-md"},tt={class:"station-name text-text-high"},et={class:"text-lg"},nt={class:"text-text-low"},st={class:"window-toggle mt-md mb-md"},ot=["onClick"],at={class:"refresh-section flex items-center"},it={key:0,class:"text-text-low ml-sm"},lt={key:1,class:"station-info card mb-lg"},rt=$({__name:"Station",props:{station:{},lastUpdated:{},windowMinutes:{},timeOptions:{}},emits:["refresh","update:windowMinutes"],setup(r){return(t,e)=>t.station?(i(),l("div",Z,[e[1]||(e[1]=a("div",{class:"station-banner"},[a("h2",{class:"station-heading text-xl font-semibold text-text-high"}," Nearest Station ")],-1)),a("p",tt,[a("strong",et,u(t.station.location_name),1),a("span",nt,"("+u(t.station.location_id)+")",1)]),a("div",st,[(i(!0),l(T,null,A(t.timeOptions,o=>(i(),l("button",{key:o.value,onClick:g=>t.$emit("update:windowMinutes",o.value),class:K(["toggle-btn p-xs rounded-md",t.windowMinutes===o.value?"bg-accent-red text-text-high":"bg-surface text-text-med"])},u(o.label),11,ot))),128))]),a("div",at,[a("button",{onClick:e[0]||(e[0]=o=>t.$emit("refresh")),class:"refresh-btn p-xs bg-accent-yellow text-text-high rounded-md"}," Refresh "),t.lastUpdated?(i(),l("span",it," Last updated: "+u(t.lastUpdated),1)):M("",!0)])])):(i(),l("div",lt,e[2]||(e[2]=[a("h2",{class:"station-heading mb-sm text-text-high"},"Nearest Station (loading)",-1),a("p",{class:"station-name text-text-high"},"Unable to locate nearest station.",-1)])))}});function ut(r){return new Date(r.replace(" ","T")).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function dt(r){const t=B(r);return new Date(Date.now()+t*6e4).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function ct(r){const t=Date.now();return(new Date(r.sched_time.replace(" ","T")).getTime()-t)/6e4}function B(r){const t=Math.ceil(ct(r)),e=V(r.status),o=t+e;return o>0?o:0}function V(r){const t=r.match(/(\d+)\s*min/);return t?parseInt(t[1],10):0}function mt(r){return r.includes("min")}const vt={class:"arrival-section card mb-lg"},gt={class:"arrival-heading mb-sm text-text-high"},pt={key:0},ht={key:1},wt={class:"arrival-list"},ft={class:"text-text-low"},bt={key:0},xt={key:0,class:"arrival-item p-sm bg-surface rounded-md mb-xs text-text-high"},yt={key:0},_t={key:1},O=$({__name:"ArrivalList",props:{title:{},trains:{},windowMinutes:{},windowLabel:{}},setup(r){return(t,e)=>(i(),l("section",vt,[a("h2",gt,[w(u(t.title)+" ",1),t.windowMinutes!=="next"?(i(),l("span",pt," (next "+u(t.windowLabel)+") ",1)):(i(),l("span",ht,"(next train only)"))]),a("ul",wt,[(i(!0),l(T,null,A(t.trains,o=>(i(),l("li",{key:o.train_id,class:"arrival-item p-sm bg-surface rounded-md mb-xs text-text-high"},[a("p",null,[e[0]||(e[0]=a("strong",null,"ID:",-1)),w(" "+u(o.train_id)+" | ",1),e[1]||(e[1]=a("strong",null,"Sched:",-1)),w(" "+u(y(ut)(o.sched_time))+" | ",1),e[2]||(e[2]=a("strong",null,"Status:",-1)),w(" "+u(o.status),1)]),a("p",ft,[e[3]||(e[3]=a("strong",null,"Arrival at:",-1)),w(" "+u(y(dt)(o))+" ",1),e[4]||(e[4]=a("br",null,null,-1)),e[5]||(e[5]=a("strong",null,"Arrival in:",-1)),w(" "+u(y(B)(o))+" min ",1),y(mt)(o.status)?(i(),l("span",bt,"  ("+u(y(V)(o.status))+" min late) ",1)):M("",!0)])]))),128)),t.trains.length?M("",!0):(i(),l("li",xt,[w(" No "+u(t.title.toLowerCase())+" trains ",1),t.windowMinutes!=="next"?(i(),l("span",yt," in the next "+u(t.windowLabel)+".",1)):(i(),l("span",_t,"."))]))])]))}}),Lt={class:"debug-panel mb-lg"},Mt=["value"],$t={key:0,class:"coord-display"},St={class:"coord mb-xs text-text-high"},kt={class:"coord text-text-high"},Dt={key:1,class:"coord-display"},Nt=$({__name:"DebugGeolocationPanel",props:{selectedLocation:{},coords:{},locations:{}},emits:["update:selectedLocation","setLocation"],setup(r,{emit:t}){const e=r,o=t,g=m(e.selectedLocation);L(()=>e.selectedLocation,p=>{g.value=p});function _(){o("update:selectedLocation",g.value),o("setLocation")}return(p,c)=>(i(),l("div",Lt,[c[3]||(c[3]=a("label",{for:"debug-location",class:"label mb-sm font-medium text-text-high"}," Debug Location ",-1)),Q(a("select",{id:"debug-location",class:"select-input mb-md p-sm bg-surface text-text-high rounded-md","onUpdate:modelValue":c[0]||(c[0]=f=>q(g)?g.value=f:null),onChange:_},[c[1]||(c[1]=a("option",{disabled:"",value:""},"Select Location",-1)),(i(!0),l(T,null,A(p.locations,(f,b)=>(i(),l("option",{key:b,value:b},u(f.name),9,Mt))),128))],544),[[W,y(g)]]),p.coords?(i(),l("div",$t,[a("p",St,"📍 latty: "+u(p.coords.latitude),1),a("p",kt,"📍 longi: "+u(p.coords.longitude),1)])):(i(),l("div",Dt,c[2]||(c[2]=[a("p",{class:"coord text-text-high"},"Grabbing lo…",-1)])))]))}}),Tt={class:"app-container p-lg bg-primary text-text-med font-base"},Ut=$({__name:"index",setup(r){m(!0);const t=m(null),e=m(null),o=m(null),g=m(!1),_=m(null),p=m(null),c=m(!1),f=[{name:"cribbo 🏠",coords:{latitude:40.0298,longitude:-75.181}},{name:"30th Street Station",coords:{latitude:39.9556,longitude:-75.182}},{name:"Suburban Station 🚆",coords:{latitude:39.9543,longitude:-75.1657}},{name:"Temple University 🍒",coords:{latitude:39.9801,longitude:-75.1541}},{name:"White House",coords:{latitude:39.9801,longitude:-75.1541}},{name:"L.A",coords:{latitude:33.953,longitude:-118.33963}}],b=m("0"),v=m(60),j=[{label:"Next",value:"next"},{label:"60 m",value:60},{label:"120 m",value:120},{label:"24 h",value:1440}];function S(n){const s=Date.now();return(new Date(n.sched_time.replace(" ","T")).getTime()-s)/6e4}async function I(n,s){try{const d=await fetch(`https://corsproxy.io/?https://www3.septa.org/api/locations/get_locations.php?lat=${n}&lon=${s}&type=rail_stations`),[x]=await d.json();return x}catch(d){return console.error("Error fetching station:",d),null}}async function U(n){const x=`https://corsproxy.io/?${`https://www3.septa.org/api/Arrivals/index.php?station=${encodeURIComponent(n)}&_=${Date.now()}`}`,h=await fetch(x,{cache:"no-store"});if(!h.ok)throw new Error(`Failed to load arrivals: ${h.status}`);const P=await h.json();return Object.values(P).flatMap(H=>H.flatMap(J=>Object.values(J).flat()))}const C=D(()=>v.value===1440?"24 hours":`${v.value} minutes`);function E(n){let s=null,d=1/0;for(const x of n){const h=S(x);h>0&&h<d&&(d=h,s=x)}return s}const z=D(()=>{if(!o.value)return[];if(v.value==="next"){const n=o.value.filter(d=>d.direction==="N"),s=E(n);return s?[s]:[]}return o.value.filter(n=>{const s=S(n);return n.direction==="N"&&s>0&&s<=v.value})}),F=D(()=>{if(!o.value)return[];if(v.value==="next"){const n=o.value.filter(d=>d.direction==="S"),s=E(n);return s?[s]:[]}return o.value.filter(n=>{const s=S(n);return n.direction==="S"&&s>0&&s<=v.value})}),k=m(null);async function G(){if(e.value)try{c.value=!0;const n=await U(e.value.location_name);o.value=n,k.value=new Date().toLocaleTimeString()}catch(n){console.error("Error refreshing arrivals:",n),p.value=n.message}finally{c.value=!1}}L(()=>e.value,async n=>{if(n)try{c.value=!0;const s=await U(n.location_name);o.value=s,k.value=new Date().toLocaleTimeString()}catch(s){console.error("Error fetching arrivals on station change:",s),p.value=s.message}finally{c.value=!1}},{immediate:!1}),L(()=>t.value,async n=>{if(n){g.value=!0,_.value=null;try{e.value=await I(n.latitude,n.longitude)}catch(s){_.value=s.message}finally{g.value=!1}}},{immediate:!0}),L(()=>e.value,n=>{n&&(document.title=`Transit Tracker - ${n.location_name}`)}),X(()=>{R()});function R(){t.value=f[Number(b.value)].coords}return(n,s)=>(i(),l("div",Tt,[s[3]||(s[3]=a("h1",{class:"heading-primary mb-md text-text-high"},"Transit Tracker",-1)),M("",!0),(i(),Y(Nt,{key:1,selectedLocation:b.value,coords:t.value,locations:f,"onUpdate:selectedLocation":s[1]||(s[1]=d=>b.value=d),onSetLocation:R},null,8,["selectedLocation","coords"])),N(rt,{station:e.value,lastUpdated:k.value,windowMinutes:v.value,timeOptions:j,onRefresh:G,"onUpdate:windowMinutes":s[2]||(s[2]=d=>v.value=d)},null,8,["station","lastUpdated","windowMinutes"]),N(O,{title:"Northbound Arrivals",trains:z.value,windowMinutes:v.value,windowLabel:C.value},null,8,["trains","windowMinutes","windowLabel"]),N(O,{title:"Southbound Arrivals",trains:F.value,windowMinutes:v.value,windowLabel:C.value},null,8,["trains","windowMinutes","windowLabel"])]))}});export{Ut as default};
